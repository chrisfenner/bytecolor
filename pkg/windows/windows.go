package windows

import (
	"encoding/hex"
	"fmt"
	"image/color"
	"math"

	"github.com/lucasb-eyer/go-colorful"
)

type palette struct{}

func (p palette) Select(b byte) [3]byte {
	return colors[b]
}

func (p palette) Nearest(c color.Color) byte {
	best := byte(0)
	bestDist := math.MaxFloat64
	for i := 0; i < 256; i++ {
		rgb := p.Select(byte(i))
		col, _ := colorful.MakeColor(c)
		dist := col.DistanceRgb(colorful.Color{float64(rgb[0]) / 255.0, float64(rgb[1]) / 255.0, float64(rgb[2]) / 255.0})
		if dist < bestDist {
			bestDist = dist
			best = byte(i)
		}
	}
	return best
}

func New() (palette, error) {
	return palette{}, nil
}

func fromHex(h string) [3]byte {
	var result [3]byte
	b, err := hex.DecodeString(h)
	if err != nil {
		panic(err)
	}
	if len(b) != 3 {
		panic(fmt.Sprintf("was not 3 bytes: '%s'", h))
	}
	copy(result[:3], b)
	return result
}

var colors = [][3]byte{
	fromHex("000000"),
	fromHex("800000"),
	fromHex("008000"),
	fromHex("808000"),
	fromHex("000080"),
	fromHex("800080"),
	fromHex("008080"),
	fromHex("c0c0c0"),
	fromHex("c0dcc0"),
	fromHex("a6caf0"),
	fromHex("2a3faa"),
	fromHex("2a3fff"),
	fromHex("2a5f00"),
	fromHex("2a5f55"),
	fromHex("2a5faa"),
	fromHex("2a5fff"),
	fromHex("2a7f00"),
	fromHex("2a7f55"),
	fromHex("2a7faa"),
	fromHex("2a7fff"),
	fromHex("2a9f00"),
	fromHex("2a9f55"),
	fromHex("2a9faa"),
	fromHex("2a9fff"),
	fromHex("2abf00"),
	fromHex("2abf55"),
	fromHex("2abfaa"),
	fromHex("2abfff"),
	fromHex("2adf00"),
	fromHex("2adf55"),
	fromHex("2adfaa"),
	fromHex("2adfff"),
	fromHex("2aff00"),
	fromHex("2aff55"),
	fromHex("2affaa"),
	fromHex("2affff"),
	fromHex("550000"),
	fromHex("550055"),
	fromHex("5500aa"),
	fromHex("5500ff"),
	fromHex("551f00"),
	fromHex("551f55"),
	fromHex("551faa"),
	fromHex("551fff"),
	fromHex("553f00"),
	fromHex("553f55"),
	fromHex("553faa"),
	fromHex("553fff"),
	fromHex("555f00"),
	fromHex("555f55"),
	fromHex("555faa"),
	fromHex("555fff"),
	fromHex("557f00"),
	fromHex("557f55"),
	fromHex("557faa"),
	fromHex("557fff"),
	fromHex("559f00"),
	fromHex("559f55"),
	fromHex("559faa"),
	fromHex("559fff"),
	fromHex("55bf00"),
	fromHex("55bf55"),
	fromHex("55bfaa"),
	fromHex("55bfff"),
	fromHex("55df00"),
	fromHex("55df55"),
	fromHex("55dfaa"),
	fromHex("55dfff"),
	fromHex("55ff00"),
	fromHex("55ff55"),
	fromHex("55ffaa"),
	fromHex("55ffff"),
	fromHex("7f0000"),
	fromHex("7f0055"),
	fromHex("7f00aa"),
	fromHex("7f00ff"),
	fromHex("7f1f00"),
	fromHex("7f1f55"),
	fromHex("7f1faa"),
	fromHex("7f1fff"),
	fromHex("7f3f00"),
	fromHex("7f3f55"),
	fromHex("7f3faa"),
	fromHex("7f3fff"),
	fromHex("7f5f00"),
	fromHex("7f5f55"),
	fromHex("7f5faa"),
	fromHex("7f5fff"),
	fromHex("7f7f00"),
	fromHex("7f7f55"),
	fromHex("7f7faa"),
	fromHex("7f7fff"),
	fromHex("7f9f00"),
	fromHex("7f9f55"),
	fromHex("7f9faa"),
	fromHex("7f9fff"),
	fromHex("7fbf00"),
	fromHex("7fbf55"),
	fromHex("7fbfaa"),
	fromHex("7fbfff"),
	fromHex("7fdf00"),
	fromHex("7fdf55"),
	fromHex("7fdfaa"),
	fromHex("7fdfff"),
	fromHex("7fff00"),
	fromHex("7fff55"),
	fromHex("7fffaa"),
	fromHex("7fffff"),
	fromHex("aa0000"),
	fromHex("aa0055"),
	fromHex("aa00aa"),
	fromHex("aa00ff"),
	fromHex("aa1f00"),
	fromHex("aa1f55"),
	fromHex("aa1faa"),
	fromHex("aa1fff"),
	fromHex("aa3f00"),
	fromHex("aa3f55"),
	fromHex("aa3faa"),
	fromHex("aa3fff"),
	fromHex("aa5f00"),
	fromHex("aa5f55"),
	fromHex("aa5faa"),
	fromHex("aa5fff"),
	fromHex("aa7f00"),
	fromHex("aa7f55"),
	fromHex("aa7faa"),
	fromHex("aa7fff"),
	fromHex("aa9f00"),
	fromHex("aa9f55"),
	fromHex("aa9faa"),
	fromHex("aa9fff"),
	fromHex("aabf00"),
	fromHex("aabf55"),
	fromHex("aabfaa"),
	fromHex("aabfff"),
	fromHex("aadf00"),
	fromHex("aadf55"),
	fromHex("aadfaa"),
	fromHex("aadfff"),
	fromHex("aaff00"),
	fromHex("aaff55"),
	fromHex("aaffaa"),
	fromHex("aaffff"),
	fromHex("d40000"),
	fromHex("d40055"),
	fromHex("d400aa"),
	fromHex("d400ff"),
	fromHex("d41f00"),
	fromHex("d41f55"),
	fromHex("d41faa"),
	fromHex("d41fff"),
	fromHex("d43f00"),
	fromHex("d43f55"),
	fromHex("d43faa"),
	fromHex("d43fff"),
	fromHex("d45f00"),
	fromHex("d45f55"),
	fromHex("d45faa"),
	fromHex("d45fff"),
	fromHex("d47f00"),
	fromHex("d47f55"),
	fromHex("d47faa"),
	fromHex("d47fff"),
	fromHex("d49f00"),
	fromHex("d49f55"),
	fromHex("d49faa"),
	fromHex("d49fff"),
	fromHex("d4bf00"),
	fromHex("d4bf55"),
	fromHex("d4bfaa"),
	fromHex("d4bfff"),
	fromHex("d4df00"),
	fromHex("d4df55"),
	fromHex("d4dfaa"),
	fromHex("d4dfff"),
	fromHex("d4ff00"),
	fromHex("d4ff55"),
	fromHex("d4ffaa"),
	fromHex("d4ffff"),
	fromHex("ff0055"),
	fromHex("ff00aa"),
	fromHex("ff1f00"),
	fromHex("ff1f55"),
	fromHex("ff1faa"),
	fromHex("ff1fff"),
	fromHex("ff3f00"),
	fromHex("ff3f55"),
	fromHex("ff3faa"),
	fromHex("ff3fff"),
	fromHex("ff5f00"),
	fromHex("ff5f55"),
	fromHex("ff5faa"),
	fromHex("ff5fff"),
	fromHex("ff7f00"),
	fromHex("ff7f55"),
	fromHex("ff7faa"),
	fromHex("ff7fff"),
	fromHex("ff9f00"),
	fromHex("ff9f55"),
	fromHex("ff9faa"),
	fromHex("ff9fff"),
	fromHex("ffbf00"),
	fromHex("ffbf55"),
	fromHex("ffbfaa"),
	fromHex("ffbfff"),
	fromHex("ffdf00"),
	fromHex("ffdf55"),
	fromHex("ffdfaa"),
	fromHex("ffdfff"),
	fromHex("ffff55"),
	fromHex("ffffaa"),
	fromHex("ccccff"),
	fromHex("ffccff"),
	fromHex("33ffff"),
	fromHex("66ffff"),
	fromHex("99ffff"),
	fromHex("ccffff"),
	fromHex("007f00"),
	fromHex("007f55"),
	fromHex("007faa"),
	fromHex("007fff"),
	fromHex("009f00"),
	fromHex("009f55"),
	fromHex("009faa"),
	fromHex("009fff"),
	fromHex("00bf00"),
	fromHex("00bf55"),
	fromHex("00bfaa"),
	fromHex("00bfff"),
	fromHex("00df00"),
	fromHex("00df55"),
	fromHex("00dfaa"),
	fromHex("00dfff"),
	fromHex("00ff55"),
	fromHex("00ffaa"),
	fromHex("2a0000"),
	fromHex("2a0055"),
	fromHex("2a00aa"),
	fromHex("2a00ff"),
	fromHex("2a1f00"),
	fromHex("2a1f55"),
	fromHex("2a1faa"),
	fromHex("2a1fff"),
	fromHex("2a3f00"),
	fromHex("2a3f55"),
	fromHex("fffbf0"),
	fromHex("a0a0a4"),
	fromHex("808080"),
	fromHex("ff0000"),
	fromHex("00ff00"),
	fromHex("ffff00"),
	fromHex("0000ff"),
	fromHex("ff00ff"),
	fromHex("00ffff"),
	fromHex("ffffff"),
}
